package rules

import java.util.List
import ma.medtech.drools.model.Transaction

global java.util.List alertes

declare Suspicion
    clientId : String
    total : int
end

rule "Accumuler transactions > 1000 DH"
when
    $clientId : String()
    $total : Number(intValue >= 3) from accumulate(
        Transaction(clientId == $clientId, montant > 1000),
        count(1)
    )
then
    alertes.add("Client " + $clientId + " a effectue " + $total + " transactions > 1000 DH");

    // Insertion d'un fait dérivé
    insert( new Suspicion($clientId, $total.intValue()) );
end

rule "Lister les transactions suspectes"
when
    $clientId : String()
    $txs : List(size > 0) from collect(
        Transaction(clientId == $clientId, montant > 1000)
    )
then
    System.out.println("Client " + $clientId + " a " + $txs.size() + " transactions suspectes.");
end

rule "Evaluer type de transaction"
when
    $t : Transaction($m : montant, $type : type, $clientId : clientId)
    eval($m > 500 && $type.equals("cash"))
then
    System.out.println("Transaction cash elevee detectee : " + $m + " pour le client " + $clientId);
end

rule "détection de transactions suspectes"
when
    Suspicion($clientId : clientId, $total : total)
then
    System.out.println("Suspicion detectee : " + $clientId + " avec un total de " + $total + " transactions suspectes.");
end
